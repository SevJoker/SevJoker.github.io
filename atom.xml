<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Seven&#39;s Blog</title>
  
  <subtitle>seven</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://sevjoker.github.io/"/>
  <updated>2019-04-20T18:00:16.000Z</updated>
  <id>http://sevjoker.github.io/</id>
  
  <author>
    <name>SevenDing</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>golang踩坑</title>
    <link href="http://sevjoker.github.io/2019/04/21/golang%E8%B8%A9%E5%9D%91/"/>
    <id>http://sevjoker.github.io/2019/04/21/golang踩坑/</id>
    <published>2019-04-20T17:54:02.000Z</published>
    <updated>2019-04-20T18:00:16.000Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Sun May 05 2019 13:07:04 GMT+0800 (China Standard Time) --><h1 id="golang-线上问题汇总"><a href="#golang-线上问题汇总" class="headerlink" title="golang 线上问题汇总"></a>golang 线上问题汇总</h1><h2 id="定时器"><a href="#定时器" class="headerlink" title="定时器"></a>定时器</h2><h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><blockquote><p>线上cpu不定时抖动</p></blockquote><h3 id="问题发现"><a href="#问题发现" class="headerlink" title="问题发现"></a>问题发现</h3><blockquote><p>大量go协程启用了NewTicker 而未主动关闭，而ticker对象会默认存储在一个最小堆上，todo</p></blockquote><h3 id="问题总结"><a href="#问题总结" class="headerlink" title="问题总结"></a>问题总结</h3><ul><li>time.After vs time.NewTicker 区分使用</li></ul><h2 id="concurrent-map-iteration-and-map-write"><a href="#concurrent-map-iteration-and-map-write" class="headerlink" title="concurrent map iteration and map write"></a>concurrent map iteration and map write</h2><h3 id="现象-1"><a href="#现象-1" class="headerlink" title="现象"></a>现象</h3><blockquote><p>线上服务直接崩溃</p></blockquote><h3 id="问题发现-1"><a href="#问题发现-1" class="headerlink" title="问题发现"></a>问题发现</h3><blockquote><p>并发读写map引起<br>不是一个panic 无法被 recover<br>This means that the Go runtime may detect if a map is read or modified in a goroutine, and it is also modified by another goroutine, concurrently, without synchronization.</p></blockquote><h3 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h3><blockquote><p>锁处理<br>sync.Map</p></blockquote><h3 id="问题衍生"><a href="#问题衍生" class="headerlink" title="问题衍生"></a>问题衍生</h3><ul><li>当一个 map被json encode时也会导致此问题（等同于读操作）</li></ul><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Sun May 05 2019 13:07:04 GMT+0800 (China Standard Time) --&gt;&lt;h1 id=&quot;golang-线上问题汇总&quot;&gt;&lt;a href=&quot;#golang-线上问题汇总&quot; class=&quot;headerlink
      
    
    </summary>
    
      <category term="技术" scheme="http://sevjoker.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="golang" scheme="http://sevjoker.github.io/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>http长连接</title>
    <link href="http://sevjoker.github.io/2019/04/20/http%E9%95%BF%E8%BF%9E%E6%8E%A5/"/>
    <id>http://sevjoker.github.io/2019/04/20/http长连接/</id>
    <published>2019-04-20T11:00:47.000Z</published>
    <updated>2019-04-20T11:09:24.000Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Sun May 05 2019 13:07:04 GMT+0800 (China Standard Time) --><h1 id="http长连接"><a href="#http长连接" class="headerlink" title="http长连接"></a>http长连接</h1><h4 id="http特点"><a href="#http特点" class="headerlink" title="http特点"></a>http特点</h4><ol><li>简单快速</li><li>灵活</li><li>无连接 *<ul><li>限制每次连接只处理一个请求</li><li>用完即断 （后期加入）</li></ul></li><li>无状态 *<ul><li>协议对于事务处理没有记忆能力</li><li>每个请求都是独立的</li><li>借助 Cookie Session 完成上下文联系</li></ul></li><li>支持B/S(Browser/Server) 及C/S(Client/Serve)模式</li></ol><p><strong>Q 无连接的特性如何实现 长连接</strong></p><h4 id="网络协议分层简介"><a href="#网络协议分层简介" class="headerlink" title="网络协议分层简介"></a>网络协议分层简介</h4><p><img src="/2019/04/20/http长连接/./1545898647502.png" alt="Alt text"></p><h4 id="http-之-Keep-alive"><a href="#http-之-Keep-alive" class="headerlink" title="http 之 Keep-alive"></a>http 之 Keep-alive</h4><blockquote><p>上图我们可以知道http 基于 tcp 协议。虽然http本身是无连接的，不过tcp是协议是完全面向连接具有强可靠性。故可以通过复用tcp连接的方式实现所谓的http长连接<br>即HTTP的长连接和短连接本质上是TCP长连接 和 短连接（握手说句话再见）</p></blockquote><h4 id="实验模型"><a href="#实验模型" class="headerlink" title="实验模型"></a>实验模型</h4><p>基于 nginx 的 keepAlive 实验<br><img src="/2019/04/20/http长连接/./1545903070532.png" alt="Alt text"></p><blockquote><p>该场景下有两个地方可以完成http长连接配置<br>针对10.10.7.179 &lt; - &gt; 10.9.71.78 进行分析</p></blockquote><h4 id="抓包分析"><a href="#抓包分析" class="headerlink" title="抓包分析"></a>抓包分析</h4><p>看包 说话</p><blockquote><p>短连接 不复用<br>demo_no_keepalive_simple.cap<br><img src="/2019/04/20/http长连接/./1545912376653.png" alt="Alt text"></p></blockquote><blockquote><p>长连接 复用tcp连接<br>demo_keepalive_simple.cap<br><img src="/2019/04/20/http长连接/./1545912386780.png" alt="Alt text"></p></blockquote><h4 id="小节"><a href="#小节" class="headerlink" title="小节"></a>小节</h4><p><img src="/2019/04/20/http长连接/./1545912037612.png" alt="Alt text"></p><h4 id="nginx-http长连接-配置"><a href="#nginx-http长连接-配置" class="headerlink" title="nginx http长连接 配置"></a>nginx http长连接 配置</h4><blockquote><p>netstat -nat | grep -i “10.9.71.78:6601”<br>观察不同配置下tcp连接的不同变化</p></blockquote><p>upstream module 中<br><img src="/2019/04/20/http长连接/./1545903165154.png" alt="Alt text"></p><p>location module 中<br><img src="/2019/04/20/http长连接/./1545903182152.png" alt="Alt text"></p><p>http module 中<br><img src="/2019/04/20/http长连接/./1545903225225.png" alt="Alt text"><br>按需配置</p><p>####性能对比</p><blockquote><p>统一 nginx 单worker, server为简单的hello world服务</p></blockquote><ol><li>禁用长连接<br><img src="/2019/04/20/http长连接/./1545878416799.png" alt="Alt text"></li><li>启用http 长连接<br><img src="/2019/04/20/http长连接/./1545878429062.png" alt="Alt text"></li></ol><p>性能差异 达到 70%+ （这个压测结果应该算是极限差距吧。按server耗时与传输占比来算）</p><h4 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h4><p>长连接多用于操作频繁，点对点的通讯，而且连接数不能太多情况<br>WEB网站的http服务一般都用短链接<br>选则法则：面向”用户多少”选择</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Sun May 05 2019 13:07:04 GMT+0800 (China Standard Time) --&gt;&lt;h1 id=&quot;http长连接&quot;&gt;&lt;a href=&quot;#http长连接&quot; class=&quot;headerlink&quot; title=&quot;htt
      
    
    </summary>
    
      <category term="技术" scheme="http://sevjoker.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="网络" scheme="http://sevjoker.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>开卷有益</title>
    <link href="http://sevjoker.github.io/2019/04/14/first/"/>
    <id>http://sevjoker.github.io/2019/04/14/first/</id>
    <published>2019-04-13T16:27:46.000Z</published>
    <updated>2019-05-05T05:06:17.922Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Sun May 05 2019 13:07:04 GMT+0800 (China Standard Time) --><h2 id="随便记点啦"><a href="#随便记点啦" class="headerlink" title="随便记点啦"></a>随便记点啦</h2><blockquote><p>好记忆不如烂笔头 何况如此懒得记东西的我</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hello blog!</span><br></pre></td></tr></table></figure><h3 id="立个小flag"><a href="#立个小flag" class="headerlink" title="立个小flag"></a>立个小flag</h3><ol><li>每月两篇blog (all type)</li><li>good good study, day day up</li><li>you need to know what are you doing ha~</li></ol><h2 id="打卡"><a href="#打卡" class="headerlink" title="打卡"></a>打卡</h2><h3 id="健身"><a href="#健身" class="headerlink" title="健身"></a>健身</h3><ul><li>2019-04-20</li></ul><h3 id="LOL"><a href="#LOL" class="headerlink" title="LOL"></a>LOL</h3><ul><li>2019-04-20</li><li>2019-05-01</li></ul><h3 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h3><ul><li>2019-04-22 golang deadline 寻密</li></ul><h3 id="鸡汤"><a href="#鸡汤" class="headerlink" title="鸡汤"></a>鸡汤</h3><ul><li>没有人会为你真正的价值买单，他们只会为他们所认为的你的价值买单</li></ul><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Sun May 05 2019 13:07:04 GMT+0800 (China Standard Time) --&gt;&lt;h2 id=&quot;随便记点啦&quot;&gt;&lt;a href=&quot;#随便记点啦&quot; class=&quot;headerlink&quot; title=&quot;随便记点啦&quot;&gt;
      
    
    </summary>
    
      <category term="随便记" scheme="http://sevjoker.github.io/categories/%E9%9A%8F%E4%BE%BF%E8%AE%B0/"/>
    
    
      <category term="随记" scheme="http://sevjoker.github.io/tags/%E9%9A%8F%E8%AE%B0/"/>
    
  </entry>
  
</feed>
